#!/bin/bash

mkmanifest () {
    declare line
    while IFS= read -r line;do
      line=${line#./}
      [[ "$line" == . ]] && continue
      echo "$line"
    done <<<  $(find . ! -path '*/_*' -a -name "README.md" -printf "%h\n"| sort -d) > MANIFEST
}


render() {
declare -r rwx_html=rwx_html_template.html
declare -r kjhealy_html=kjhealy_html_template.html
declare -r rwx_css=rwx_css_template.css
declare -r css=pandoc.css


declare dir="$1"
echo Building $dir
pandoc -s -o  "$dir/index.html" --quiet --css=pandoc.css  --template=$kjhealy_html "./$dir/README.md"
}
  
mkmanifest

render .

while IFS= read -r dir; do
  render $dir
done < MANIFEST

#pandoc --template=template.html --quiet -o ./index.html -s ./README.md
#pandoc --template=template.html --quiet -o ./help/index.html -s ./help/README.md
#pandoc --template=template.html --quiet -o ./another/index.html -s ./another/README.md
